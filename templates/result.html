{% extends "base.html" %}
{% block content %}


<section id="second2">
    <div id="loading-screen">
        <div id="loading-spinner">Now creating...</div>
        <div id="loading-tips" class="slide">
          <div class="tips">
            <img src="../static/images/cat-ケイティ.png">
            <p>
              陽気で好奇心旺盛な猫人族の冒険者。
              <br>
              探索中に珍しいものを見つけると周りが見えなくなり、
              <br>
              そのせいで山肌を転がり落ちることもしばしば。
              <br>
              しかし猫人族の柔軟性に富んだ体のおかげで大抵はけろっとした顔で帰ってくる。
            </p>
          </div>
          <div class="tips">
          <img src="../static/images/カミラ.png">
          <p>
            美しい深紅の髪を持つミステリアスな人族。
            <br>
            郊外の村で農作物を育てているが、
            <br>
            実は凄腕の暗殺者だとか、実は高貴な血筋だとか、
            <br>
            様々なうわさがまことしやかに流れている。
          </p>
          </div>
          <div class="tips">
          <img src="../static/images/elf-レイリー.png">
          <p>
            エルフ
            <br>
            静かなところが好き。
            </p>
          </div>
          <div class="tips">
          <img src="../static/images/fairy-アクア.png">
          <p>
            変わり者の妖精族。
            <br>
            人懐っこい。
          </p>
          </div>
          <div class="tips">
          <img src="../static/images/wolf-ガイア仮.png">
          <p>
            武者修行の旅をする狼人族。
            <br>
            質実剛健の鑑ともいうべき性格をしており、
            <br>
            種族問わず多くの人々に慕われている。
          </p>
          </div>
        </div>
        <div id="loading-time">ローディング時間: <span id="loading-duration">0.00</span> 秒</div>
    </div>
    <div class="result" hidden>
      <p>異世界のあなたの姿は…</p>
      <p>
        <img src="{{ img_path }}" alt="結果" class="result_image"/>
      </p>
    </div>
</section>

<script>
  // ローディング画面、画像生成の非同期処理
  $(document).ready(function () {
    const startTime = new Date().getTime();
    $('#loading-screen').show();

    // ローディング時間を計算
    const updateLoadingTime = () => {
      var currentTime = new Date().getTime();
      var elapsedSeconds = (currentTime - startTime) / 1000;
      $('#loading-duration').text(elapsedSeconds.toFixed(2));
    }
    const updateInterval = setInterval(updateLoadingTime, 100);

    $.ajax({
      type: 'POST',
      url: '/generate_image',
      data: { prompt: {{ prompt | tojson }} },
      success: function (data) {
        clearInterval(updateInterval);
        $('#loading-screen').hide();
        $('.result_image').attr('src', `static/images/${data.file_name}`);
        $('.result').show();
      },
      error: function (error) {
        console.error(error);
      }
    });
  });
</script>

{% endblock %}
